PROCEDURE CREATE_INITIALS IS
BEGIN
IF :FIRST_NAME IS NOT NULL AND :LAST_NAME IS NOT NULL THEN
  IF :SYSTEM.RECORD_STATUS = 'INSERT' THEN
    :GLOBAL.TEMP_PERSON_KEY := 0;
  ELSE
    :GLOBAL.TEMP_PERSON_KEY := :PERSON.PERSON_KEY;
  END IF;
   DECLARE
    TEMP_INITIALS   CHAR(3);
    TEMP2_INITIALS  CHAR(5);
    TEMP3_INITIALS  CHAR(5);
   BEGIN
    TEMP_INITIALS := SUBSTR(:FIRST_NAME,1,1)||SUBSTR(:MIDDLE_NAME,1,1)||
               SUBSTR(:LAST_NAME,1,1);
    :GLOBAL.TEMP_INITIALS := TEMP_INITIALS;
BREAK;
    SELECT INITIALS INTO TEMP2_INITIALS FROM PERSONS
     WHERE SUBSTR(INITIALS,1,3) = TEMP_INITIALS AND
       PERSON_KEY_2 = :GLOBAL.TEMP_PERSON_KEY;
       :GLOBAL.TE_INITIALS := TEMP2_INITIALS;
BREAK;
       BEGIN
         SELECT INITIALS INTO TEMP3_INITIALS FROM employee
         WHERE INITIALS = TEMP2_INITIALS;
         :GLOBAL.TEMP_3 := TEMP3_INITIALS;
         :INITIALS := TEMP_INITIALS||
          TO_CHAR(TO_NUMBER(NVL(SUBSTR(TEMP3_INITIALS,4,2),0))+1);
       END;
   EXCEPTION
    WHEN NO_DATA_FOUND THEN
       :GLOBAL.TEMP_INIT_NULL := -1;
       :INITIALS := TEMP_INITIALS;
    WHEN TOO_MANY_ROWS THEN

     BEGIN
       SELECT MAX(INITIALS) INTO TEMP3_INITIALS FROM employee
       WHERE SUBSTR(INITIALS,1,3) = TEMP_INITIALS;
      :GLOBAL.TEMP_3A := TEMP3_INITIALS;

      :INITIALS := TEMP_INITIALS||
        TO_CHAR(TO_NUMBER(NVL(SUBSTR(TEMP3_INITIALS,4,2),0))+1);
     EXCEPTION
       WHEN OTHERS THEN
        NULL;
     END;
   END;
  ELSE
   :INITIALS := NULL;
 END IF;
END;
